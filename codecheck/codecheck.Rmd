---
output:
  pdf_document:
    toc: false
    includes:
       in_header: codecheck-preamble.sty
  html_document:
    self_contained: false
    toc: true
    toc_float: false
---

```{r rsetup,eval=TRUE,include=FALSE}
require(codecheck)
require(knitr)
require(rprojroot)
require(yaml)
require(xtable)
require(tibble)
require(readr)
options(width=60)
opts_chunk$set(cache=FALSE)

root = find_root("codecheck.yml")
```

```{r codecheck_logo, echo=FALSE,results='asis'}
latex_codecheck_logo()
```

```{r manifest, eval=TRUE, include=FALSE}
metadata = codecheck_metadata(root)
manifest = metadata$manifest

dest_dir = file.path(root, "codecheck", "outputs")
## Create the outputs directory if missing
if ( !dir.exists(dest_dir) ) {
  dir.create(dest_dir)
}

manifest_df = copy_manifest_files(root, metadata,
                                  dest_dir, keep_full_path=FALSE)
```

---
title: `r paste("CODECHECK certificate", metadata$certificate)`
subtitle: `r codecheck:::as_latex_url(metadata$report)`
---

```{r summary_metadata, echo=FALSE, results='asis'}
latex_summary_of_metadata(metadata)
```

```{r summary_manifest, echo=FALSE, results='asis'}
latex_summary_of_manifest(metadata, manifest_df, root)
```


# Summary

The main difficulty in checking this code was the Python package ANNarchy. The version that the ReScience authors had used could not be made to work, so the latest ANNarchy version had to be used. Once this was installed all of the scripts ran and most produced figures matching those in the ReScience paper. However, two figures (Figure 1 Middle and Figure 2) did not match those in the paper. It was also found that changing the seeds from those used by the original authors produced significant variation in the figures.

\clearpage

# CODECHECKER notes

The original code was stored in the Github repo here: https://github.com/rLarisch/ReScience-submission/tree/Larisch-2019/code. Code was written in Python 3 and used the Python package ANNarchy extensively.

To run the code I first cloned the repo in a Linux terminal. I then created a Conda environment called ann_1 in the cloned repo and installed the packages listed in the README:

$ conda create -n ann_1
$ conda activate ann_1
$ conda install numpy cython pip
$ pip install ANNarchy

The individual figures could then be produced by running the respective scripts e.g.

$ python Fig1_pairing.py

The figures were automatically saved in the code directory. All scripts except Fig4_RF.py took less than 15 seconds to run. Fig4_RF.py took substantially longer at around 30 minutes.



\setcounter{table}{0}
\setcounter{figure}{0}
\captionsetup[table]{labelformat=addC}
\captionsetup[figure]{labelformat=addC}

\clearpage

```{r, echo=FALSE, fig.cap=manifest_df[1:10,"comment"]}
# TODO turn into a loop 
knitr::include_graphics(manifest_df[1, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[2, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[3, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[4, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[5, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[6, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[7, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[8, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[9, "dest"])
cat('\n\n')
knitr::include_graphics(manifest_df[10, "dest"])
```

\clearpage



## Acknowledgements

I would like to thank Dr Bhatt and his team for promptly answering any
queries I had with this reproduction.  CODECHECK is financially
supported by the Mozilla foundation.


# Citing this document

```{r, results='asis',echo=FALSE}
cite_certificate(metadata)
```

# About CODECHECK

This certificate confirms that the codechecker could independently
reproduce the results of a computational analysis given the data and
code from a third party.  A CODECHECK does not check whether the
original computation analysis is correct.  However, as all materials
required for the reproduction are freely available by following the
links in this document, the reader can then study for themselves the
code and data.


# About this document

This document was created using [R Markdown](https://rmarkdown.rstudio.com/) using the [`codecheck`](https://github.com/codecheckers/codecheck) R package.
`make codecheck.pdf` will regenerate the report file.

```{r}
sessionInfo()
```

```{r, include=FALSE, eval=FALSE}
# render this document in RStudio
rmarkdown::render("codecheck.Rmd", output_format = "pdf_document") 
```
